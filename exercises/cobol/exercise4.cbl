IDENTIFICATION DIVISION.
PROGRAM-ID. SWIFTPAYMENTBICDB2.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT SWIFT-BIC-FILE ASSIGN TO 'SWIFTBIC.TXT'
        ORGANIZATION IS LINE SEQUENTIAL
        FILE STATUS IS WS-FILE-STATUS.

DATA DIVISION.
FILE SECTION.
FD SWIFT-BIC-FILE.
01 SWIFT-BIC-RECORD.
   05 SWIFT-CODE PIC X(11).
   05 FILLER PIC X(01).
   05 PAYMENT-AMOUNT PIC 9(05)V99.
   05 FILLER PIC X(01).
   05 PAYMENT-CURRENCY PIC X(03).
   05 FILLER PIC X(01).
   05 PAYMENT-DATE PIC 9(08).
   05 FILLER PIC X(01).
   05 BIC-CODE PIC X(11).

WORKING-STORAGE SECTION.
01 END-OF-FILE-SWITCH PIC X VALUE 'N'.
01 WS-FILE-STATUS PIC 99.

EXEC SQL INCLUDE SQLCA END-EXEC.

PROCEDURE DIVISION.
OPEN-FILE.
    OPEN INPUT SWIFT-BIC-FILE.

READ-FILE.
    READ SWIFT-BIC-FILE
        AT END MOVE 'Y' TO END-OF-FILE-SWITCH
    END-READ.

PROCESS-FILE.
    PERFORM UNTIL END-OF-FILE-SWITCH = 'Y'
        PERFORM VALIDATE-SWIFT-PAYMENT
        IF SQLCODE = ZERO
            EXEC SQL
                INSERT INTO SWIFT_BIC_TABLE (SWIFT_CODE, PAYMENT_AMOUNT, PAYMENT_CURRENCY, PAYMENT_DATE, BIC_CODE)
                VALUES (:SWIFT-CODE, :PAYMENT-AMOUNT, :PAYMENT-CURRENCY, :PAYMENT-DATE, :BIC-CODE)
            END-EXEC
        END-IF
        READ SWIFT-BIC-FILE
            AT END MOVE 'Y' TO END-OF-FILE-SWITCH
        END-READ
    END-PERFORM.

VALIDATE-SWIFT-PAYMENT.
    IF SWIFT-CODE = SPACES
        DISPLAY 'Invalid SWIFT Code'
    END-IF.
    IF PAYMENT-AMOUNT = ZERO
        DISPLAY 'Invalid Payment Amount'
    END-IF.
    IF PAYMENT-CURRENCY = SPACES
        DISPLAY 'Invalid Payment Currency'
    END-IF.
    IF PAYMENT-DATE = ZERO
        DISPLAY 'Invalid Payment Date'
    END-IF.
    IF BIC-CODE = SPACES
        DISPLAY 'Invalid BIC Code'
    END-IF.

CLOSE-FILE.
    CLOSE SWIFT-BIC-FILE.

STOP RUN.

USE AFTER STANDARD ERROR PROCEDURE ON SWIFT-BIC-FILE.
    DISPLAY 'An error occurred with file: ' WS-FILE-STATUS.
